<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>注音大挑戰</title>
    <style>
        /* 基礎樣式 */
        body {
            font-family: '微軟正黑體', 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f4f8;
            padding: 20px;
            margin: 0;
        }

        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 750px;
            min-height: 450px;
            position: relative;
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        /* 選單樣式 */
        #start-screen, #result-screen {
            text-align: center;
        }

        .question-selection button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s, transform 0.1s;
        }

        .question-selection button:hover {
            background-color: #2980b9;
        }

        .question-selection button:active {
            transform: scale(0.98);
        }

        /* 遊戲介面樣式 */
        #quiz-screen {
            display: none;
            text-align: center;
        }

        #timer {
            font-size: 1.8em;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 15px;
            padding: 5px 15px;
            border: 2px solid #e74c3c;
            border-radius: 5px;
            display: inline-block;
        }

        #score-display {
            font-size: 1.2em;
            color: #27ae60;
            margin-bottom: 20px;
            font-weight: bold;
        }

        #question-word {
            font-size: 6em; 
            font-weight: 900;
            margin: 20px 0;
            color: #2c3e50;
            line-height: 1.2;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 兩欄佈局 */
            gap: 15px;
            margin-top: 25px;
        }

        .option-button {
            background-color: #ecf0f1;
            color: #2c3e50;
            border: 1px solid #bdc3c7;
            padding: 15px 10px;
            font-size: 1.8em; 
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }

        .option-button:hover {
            background-color: #dce1e3;
        }

        /* 答案反饋 */
        .option-button.correct {
            background-color: #2ecc71;
            color: white;
        }

        .option-button.incorrect {
            background-color: #e74c3c;
            color: white;
        }

        /* 結果頁面樣式 */
        .result-stats {
            margin-top: 30px;
            font-size: 1.2em;
        }

        .result-stats p {
            padding: 8px 0;
            border-bottom: 1px dashed #ccc;
        }

        .result-stats strong {
            color: #34495e;
            font-weight: bold;
        }

        .back-button {
            margin-top: 30px;
            background-color: #f39c12;
        }

        .back-button:hover {
            background-color: #e67e22;
        }

        /* 倒數計時專用樣式 */
        #countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            color: white;
            font-size: 10em;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.3s;
        }


        /* --- 手機版適應性調整 (Media Query) --- */
        @media screen and (max-width: 600px) {
            body {
                padding: 0;
            }
            
            .container {
                padding: 15px; 
                width: 100%; 
                max-width: 100%;
                min-height: 100vh;
                box-shadow: none; 
                border-radius: 0;
            }

            h1 {
                font-size: 1.5em; 
                margin-bottom: 20px;
            }

            #question-word {
                font-size: 4.5em; 
                margin: 10px 0;
            }

            .option-button {
                font-size: 1.5em; 
                padding: 15px 8px; 
            }

            .options-grid {
                gap: 10px; 
            }

            .question-selection button {
                display: block; 
                width: 100%;
                margin: 10px 0;
            }

            #timer, #score-display, #current-q {
                font-size: 1em; 
            }
            
            #countdown-overlay {
                font-size: 8em; 
            }
        }
    </style>
</head>
<body>

<div id="countdown-overlay" style="display:none;">
    <span id="countdown-number">3</span>
</div>

<div class="container">
    <h1>注音大挑戰</h1>

    <div id="start-screen">
        <h2>請選擇想挑戰的題數：</h2>
        <div class="question-selection">
            <button onclick="startGame(25)">挑戰 25 題</button>
            <button onclick="startGame(50)">挑戰 50 題</button>
            <button onclick="startGame(150)">挑戰 150 題</button>
        </div>
    </div>

    <div id="quiz-screen">
        <div id="status-bar">
            <span id="current-q">第 1 題 / 共 25 題</span> | 
            <span id="score-display">總分數: 0</span>
        </div>
        <div id="timer">時間: <span id="time-left"></span>s</div>

        <p id="question-word">字</p>

        <div class="options-grid" id="options-container">
            <button class="option-button" data-option="1" onclick="checkAnswer(this)"></button>
            <button class="option-button" data-option="2" onclick="checkAnswer(this)"></button>
            <button class="option-button" data-option="3" onclick="checkAnswer(this)"></button>
            <button class="option-button" data-option="4" onclick="checkAnswer(this)"></button>
        </div>
    </div>

    <div id="result-screen" style="display:none;">
        <h2>挑戰結束！</h2>
        <h3 style="color:#e67e22;">最終得分：<span id="final-score">0</span> 分</h3>
        
        <div class="result-stats">
            <p>✅ 答對題數：<strong id="correct-count">0</strong> 題</p>
            <p>❌ 答錯題數：<strong id="wrong-count">0</strong> 題</p>
            <p>⏸️ 未作答題數：<strong id="skipped-count">0</strong> 題</p>
        </div>

        <button class="back-button" onclick="resetGame()">返回主選單</button>
    </div>

</div>

<script>
    // --- 遊戲邏輯變數 ---
    let currentQuiz = []; 
    let currentQuestionIndex = 0;
    let score = 0;
    let correctCount = 0;
    let wrongCount = 0;
    let skippedCount = 0;
    let totalQuestions = 0;
    let timer;
    let startTime;
    let timeLimit; 

    // --- 150 題注音題庫 (50 簡單 + 100 較難字, 均為教育部單一讀音) ---
    // 計分規則：簡單題基礎 10 分 (3s內+5額外分) / 較難題基礎 15 分 (5s內+10額外分)
    const allQuizData = [
        // 簡單題 (EASY) - 50 題
        { word: "人", correct: "ㄖㄣˊ", options: ["ㄖㄣˊ", "ㄧㄣˊ", "ㄇㄢˊ", "ㄋㄩˇ"], difficulty: "easy" },
        { word: "日", correct: "ㄖˋ", options: ["ㄖˋ", "ㄌㄧˋ", "ㄇㄧˋ", "ㄖㄨˋ"], difficulty: "easy" },
        { word: "山", correct: "ㄕㄢ", options: ["ㄕㄢ", "ㄔㄢ", "ㄒㄧㄢ", "ㄙㄢ"], difficulty: "easy" },
        { word: "水", correct: "ㄕㄨㄟˇ", options: ["ㄕㄨㄟˇ", "ㄕㄨㄛˇ", "ㄔㄨㄟˇ", "ㄒㄩㄝˇ"], difficulty: "easy" },
        { word: "月", correct: "ㄩㄝˋ", options: ["ㄩㄝˋ", "ㄧㄝˋ", "ㄖㄨˋ", "ㄌㄩㄝˋ"], difficulty: "easy" },
        { word: "火", correct: "ㄏㄨㄛˇ", options: ["ㄏㄨㄛˇ", "ㄈㄛˇ", "ㄏㄨˊ", "ㄏㄨㄞˇ"], difficulty: "easy" },
        { word: "田", correct: "ㄊㄧㄢˊ", options: ["ㄊㄧㄢˊ", "ㄉㄧㄢˋ", "ㄊㄧㄢˇ", "ㄊㄧㄥˊ"], difficulty: "easy" },
        { word: "土", correct: "ㄊㄨˇ", options: ["ㄊㄨˇ", "ㄉㄨˋ", "ㄗㄨㄛˋ", "ㄔㄨˇ"], difficulty: "easy" },
        { word: "木", correct: "ㄇㄨˋ", options: ["ㄇㄨˋ", "ㄇㄛˋ", "ㄇㄚˋ", "ㄇㄧˋ"], difficulty: "easy" },
        { word: "鳥", correct: "ㄋㄧㄠˇ", options: ["ㄋㄧㄠˇ", "ㄉㄧㄠˇ", "ㄌㄧㄠˇ", "ㄓㄠˇ"], difficulty: "easy" },
        { word: "魚", correct: "ㄩˊ", options: ["ㄩˊ", "ㄧˊ", "ㄨˊ", "ㄌㄩˊ"], difficulty: "easy" },
        { word: "狗", correct: "ㄍㄡˇ", options: ["ㄍㄡˇ", "ㄐㄧㄡˇ", "ㄎㄡˇ", "ㄍㄨㄛˇ"], difficulty: "easy" },
        { word: "貓", correct: "ㄇㄠ", options: ["ㄇㄠ", "ㄇㄠˊ", "ㄇㄠˇ", "ㄇㄧㄠ"], difficulty: "easy" },
        { word: "母", correct: "ㄇㄨˇ", options: ["ㄇㄨˇ", "ㄇㄛˇ", "ㄇㄨˋ", "ㄇㄛ"], difficulty: "easy" },
        { word: "父", correct: "ㄈㄨˋ", options: ["ㄈㄨˋ", "ㄅㄨˋ", "ㄇㄨˋ", "ㄈㄨ"], difficulty: "easy" },
        { word: "跳", correct: "ㄊㄧㄠˋ", options: ["ㄊㄧㄠˋ", "ㄉㄧㄠˋ", "ㄒㄧㄠˋ", "ㄑㄧㄠˋ"], difficulty: "easy" },
        { word: "吃", correct: "ㄔ", options: ["ㄔ", "ㄘ", "ㄕ", "ㄖ"], difficulty: "easy" },
        { word: "喝", correct: "ㄏㄜ", options: ["ㄏㄜ", "ㄍㄜ", "ㄎㄜ", "ㄜ"], difficulty: "easy" },
        { word: "書", correct: "ㄕㄨ", options: ["ㄕㄨ", "ㄔㄨ", "ㄒㄩ", "ㄖㄨ"], difficulty: "easy" },
        { word: "筆", correct: "ㄅㄧˇ", options: ["ㄅㄧˇ", "ㄆㄧˇ", "ㄇㄧˇ", "ㄉㄧˇ"], difficulty: "easy" },
        { word: "電", correct: "ㄉㄧㄢˋ", options: ["ㄉㄧㄢˋ", "ㄊㄧㄢˋ", "ㄋㄧㄢˋ", "ㄌㄧㄢˋ"], difficulty: "easy" },
        { word: "話", correct: "ㄏㄨㄚˋ", options: ["ㄏㄨㄚˋ", "ㄈㄚˋ", "ㄍㄨㄚˋ", "ㄏㄨㄚ"], difficulty: "easy" },
        { word: "房", correct: "ㄈㄤˊ", options: ["ㄈㄤˊ", "ㄆㄤˊ", "ㄇㄤˊ", "ㄉㄤˊ"], difficulty: "easy" },
        { word: "家", correct: "ㄐㄧㄚ", options: ["ㄐㄧㄚ", "ㄑㄧㄚ", "ㄒㄧㄚ", "ㄓㄚ"], difficulty: "easy" },
        { word: "笑", correct: "ㄒㄧㄠˋ", options: ["ㄒㄧㄠˋ", "ㄕㄠˋ", "ㄑㄧㄠˋ", "ㄗㄠˋ"], difficulty: "easy" },
        { word: "哭", correct: "ㄎㄨ", options: ["ㄎㄨ", "ㄍㄨ", "ㄏㄨ", "ㄈㄨ"], difficulty: "easy" },
        { word: "走", correct: "ㄗㄡˇ", options: ["ㄗㄡˇ", "ㄘㄡˇ", "ㄙㄡˇ", "ㄓㄡˇ"], difficulty: "easy" },
        { word: "站", correct: "ㄓㄢˋ", options: ["ㄓㄢˋ", "ㄔㄢˋ", "ㄕㄢˋ", "ㄗㄢˋ"], difficulty: "easy" },
        { word: "聽", correct: "ㄊㄧㄥ", options: ["ㄊㄧㄥ", "ㄉㄧㄥ", "ㄋㄧㄥ", "ㄌㄧㄥ"], difficulty: "easy" },
        { word: "說", correct: "ㄕㄨㄛ", options: ["ㄕㄨㄛ", "ㄔㄨㄛ", "ㄒㄩㄝ", "ㄖㄨㄛ"], difficulty: "easy" },
        { word: "事", correct: "ㄕˋ", options: ["ㄕˋ", "ㄔˋ", "ㄙˋ", "ㄗˋ"], difficulty: "easy" },
        { word: "高", correct: "ㄍㄠ", options: ["ㄍㄠ", "ㄎㄠ", "ㄏㄠ", "ㄗㄠ"], difficulty: "easy" },
        { word: "低", correct: "ㄉㄧ", options: ["ㄉㄧ", "ㄊㄧ", "ㄋㄧ", "ㄌㄧ"], difficulty: "easy" },
        { word: "大", correct: "ㄉㄚˋ", options: ["ㄉㄚˋ", "ㄊㄚˋ", "ㄋㄚˋ", "ㄌㄚˋ"], difficulty: "easy" },
        { word: "小", correct: "ㄒㄧㄠˇ", options: ["ㄒㄧㄠˇ", "ㄑㄧㄠˇ", "ㄕㄠˇ", "ㄐㄧㄠˇ"], difficulty: "easy" },
        { word: "來", correct: "ㄌㄞˊ", options: ["ㄌㄞˊ", "ㄋㄞˊ", "ㄉㄞˊ", "ㄊㄞˊ"], difficulty: "easy" },
        { word: "去", correct: "ㄑㄩˋ", options: ["ㄑㄩˋ", "ㄒㄩˋ", "ㄐㄩˋ", "ㄩˋ"], difficulty: "easy" },
        { word: "穿", correct: "ㄔㄨㄢ", options: ["ㄔㄨㄢ", "ㄗㄨㄢ", "ㄘㄨㄢ", "ㄕㄨㄢ"], difficulty: "easy" },
        { word: "衣", correct: "ㄧ", options: ["ㄧ", "ㄜ", "ㄛ", "ㄨ"], difficulty: "easy" },
        { word: "鞋", correct: "ㄒㄧㄝˊ", options: ["ㄒㄧㄝˊ", "ㄑㄧㄝˊ", "ㄐㄧㄝˊ", "ㄕㄝˊ"], difficulty: "easy" },
        { word: "帽", correct: "ㄇㄠˋ", options: ["ㄇㄠˋ", "ㄅㄠˋ", "ㄆㄠˋ", "ㄈㄠˋ"], difficulty: "easy" },
        { word: "錢", correct: "ㄑㄧㄢˊ", options: ["ㄑㄧㄢˊ", "ㄐㄧㄢˊ", "ㄒㄧㄢˊ", "ㄓㄢˊ"], difficulty: "easy" },
        { word: "買", correct: "ㄇㄞˇ", options: ["ㄇㄞˇ", "ㄅㄞˇ", "ㄆㄞˇ", "ㄈㄞˇ"], difficulty: "easy" },
        { word: "賣", correct: "ㄇㄞˋ", options: ["ㄇㄞˋ", "ㄅㄞˋ", "ㄆㄞˋ", "ㄈㄞˋ"], difficulty: "easy" },
        { word: "開", correct: "ㄎㄞ", options: ["ㄎㄞ", "ㄍㄞ", "ㄏㄞ", "ㄐㄧㄝ"], difficulty: "easy" },
        { word: "關", correct: "ㄍㄨㄢ", options: ["ㄍㄨㄢ", "ㄎㄨㄢ", "ㄏㄨㄢ", "ㄐㄩㄢ"], difficulty: "easy" },
        { word: "光", correct: "ㄍㄨㄤ", options: ["ㄍㄨㄤ", "ㄎㄨㄤ", "ㄏㄨㄤ", "ㄨㄤ"], difficulty: "easy" },
        { word: "暗", correct: "ㄢˋ", options: ["ㄢˋ", "ㄧㄣˋ", "ㄨㄢˋ", "ㄣˋ"], difficulty: "easy" },
        { word: "手", correct: "ㄕㄡˇ", options: ["ㄕㄡˇ", "ㄔㄡˇ", "ㄒㄧㄡˇ", "ㄖㄡˇ"], difficulty: "easy" },
        { word: "足", correct: "ㄗㄨˊ", options: ["ㄗㄨˊ", "ㄘㄨˊ", "ㄙㄨˊ", "ㄓㄨˊ"], difficulty: "easy" },

        // 較難題 (HARD) - 100 題
        { word: "躊", correct: "ㄔㄡˊ", options: ["ㄔㄡˊ", "ㄓㄡˊ", "ㄔㄡˇ", "ㄓˋ"], difficulty: "hard" },
        { word: "釁", correct: "ㄒㄧㄣˋ", options: ["ㄒㄧㄣˋ", "ㄒㄧㄣ", "ㄌㄧㄣˋ", "ㄒㄧㄥˋ"], difficulty: "hard" },
        { word: "倏", correct: "ㄕㄨ", options: ["ㄕㄨ", "ㄕㄡ", "ㄙㄨ", "ㄊㄨ"], difficulty: "hard" },
        { word: "攫", correct: "ㄐㄩㄝˊ", options: ["ㄐㄩㄝˊ", "ㄐㄩˋ", "ㄐㄩㄝˇ", "ㄍㄨㄛˊ"], difficulty: "hard" },
        { word: "絢", correct: "ㄒㄩㄢˋ", options: ["ㄒㄩㄢˋ", "ㄒㄩㄢˇ", "ㄒㄩㄣˋ", "ㄏㄨㄢˋ"], difficulty: "hard" },
        { word: "蓊", correct: "ㄨㄥˇ", options: ["ㄨㄥˇ", "ㄨㄥ", "ㄧㄥˇ", "ㄨㄣˇ"], difficulty: "hard" },
        { word: "箴", correct: "ㄓㄣ", options: ["ㄓㄣ", "ㄐㄧㄣ", "ㄘㄣ", "ㄓㄢ"], difficulty: "hard" },
        { word: "虯", correct: "ㄑㄧㄡˊ", options: ["ㄑㄧㄡˊ", "ㄐㄧㄡˇ", "ㄑㄧㄡˇ", "ㄑㄧㄥˊ"], difficulty: "hard" },
        { word: "巉", correct: "ㄔㄢˊ", options: ["ㄔㄢˊ", "ㄐㄧㄢ", "ㄔㄢ", "ㄉㄢˊ"], difficulty: "hard" },
        { word: "囁", correct: "ㄋㄧㄝˋ", options: ["ㄋㄧㄝˋ", "ㄓㄜˊ", "ㄋㄧㄝˇ", "ㄐㄧㄝˊ"], difficulty: "hard" },
        { word: "韜", correct: "ㄊㄠ", options: ["ㄊㄠ", "ㄉㄠ", "ㄊㄠˊ", "ㄊㄨㄛˊ"], difficulty: "hard" },
        { word: "饜", correct: "ㄧㄢˋ", options: ["ㄧㄢˋ", "ㄧㄢ", "ㄢ", "ㄧㄝ"], difficulty: "hard" }, 
        { word: "籓", correct: "ㄈㄢ", options: ["ㄈㄢ", "ㄆㄢ", "ㄈㄢˊ", "ㄅㄢ"], difficulty: "hard" },
        { word: "孑", correct: "ㄐㄧㄝˊ", options: ["ㄐㄧㄝˊ", "ㄓㄜˊ", "ㄐㄧㄝ", "ㄗㄧ"], difficulty: "hard" },
        { word: "囓", correct: "ㄋㄧㄝˋ", options: ["ㄋㄧㄝˋ", "ㄐㄧㄝˊ", "ㄧㄝˋ", "ㄋㄧㄝˇ"], difficulty: "hard" },
        { word: "襤", correct: "ㄌㄢˊ", options: ["ㄌㄢˊ", "ㄋㄢˊ", "ㄌㄢˇ", "ㄌㄢ"], difficulty: "hard" },
        { word: "嶸", correct: "ㄖㄨㄥˊ", options: ["ㄖㄨㄥˊ", "ㄧㄥˊ", "ㄌㄨㄥˊ", "ㄖㄨㄥ"], difficulty: "hard" },
        { word: "賒", correct: "ㄕㄜ", options: ["ㄕㄜ", "ㄓㄜ", "ㄕㄜˊ", "ㄒㄧㄝ"], difficulty: "hard" },
        { word: "釉", correct: "ㄧㄡˋ", options: ["ㄧㄡˋ", "ㄧㄡˊ", "ㄌㄧㄡˋ", "ㄓㄡˋ"], difficulty: "hard" },
        { word: "謔", correct: "ㄒㄩㄝˋ", options: ["ㄒㄩㄝˋ", "ㄏㄨㄛˋ", "ㄧㄠˋ", "ㄒㄧㄠˋ"], difficulty: "hard" },
        { word: "醱", correct: "ㄈㄚ", options: ["ㄈㄚ", "ㄅㄛ", "ㄆㄛ", "ㄈㄚˋ"], difficulty: "hard" },
        { word: "齷", correct: "ㄨㄛˋ", options: ["ㄨㄛˋ", "ㄛˋ", "ㄩㄝˋ", "ㄨㄛ"], difficulty: "hard" },
        { word: "齪", correct: "ㄔㄨㄛˋ", options: ["ㄔㄨㄛˋ", "ㄓㄨㄛˊ", "ㄘㄨㄛˋ", "ㄑㄩㄝˋ"], difficulty: "hard" },
        { word: "恫", correct: "ㄉㄨㄥˋ", options: ["ㄉㄨㄥˋ", "ㄊㄨㄥˋ", "ㄉㄨㄥ", "ㄓㄨㄥˋ"], difficulty: "hard" },
        { word: "慄", correct: "ㄌㄧˋ", options: ["ㄌㄧˋ", "ㄌㄧˇ", "ㄌㄧˊ", "ㄐㄩˋ"], difficulty: "hard" },
        { word: "姸", correct: "ㄧㄢˊ", options: ["ㄧㄢˊ", "ㄐㄧㄢ", "ㄧㄢ", "ㄋㄧㄢˊ"], difficulty: "hard" },
        { word: "圮", correct: "ㄆㄧˇ", options: ["ㄆㄧˇ", "ㄆㄧˋ", "ㄅㄧˇ", "ㄘˇ"], difficulty: "hard" },
        { word: "覬", correct: "ㄐㄧˋ", options: ["ㄐㄧˋ", "ㄑㄧˋ", "ㄐㄧ", "ㄍㄨㄟ"], difficulty: "hard" },
        { word: "覦", correct: "ㄩˊ", options: ["ㄩˊ", "ㄩˋ", "ㄖㄨˊ", "ㄩˇ"], difficulty: "hard" },
        { word: "躑", correct: "ㄓˊ", options: ["ㄓˊ", "ㄔˊ", "ㄓˋ", "ㄉㄧˊ"], difficulty: "hard" },
        { word: "囿", correct: "ㄧㄡˋ", options: ["ㄧㄡˋ", "ㄧㄡˊ", "ㄉㄧㄡˋ", "ㄧㄡ"], difficulty: "hard" },
        { word: "逡", correct: "ㄑㄩㄣ", options: ["ㄑㄩㄣ", "ㄗㄨㄣ", "ㄐㄩㄣ", "ㄒㄩㄣ"], difficulty: "hard" },
        { word: "堙", correct: "ㄧㄣ", options: ["ㄧㄣ", "ㄣ", "ㄧㄥ", "ㄧㄣˋ"], difficulty: "hard" },
        { word: "呶", correct: "ㄋㄠˊ", options: ["ㄋㄠˊ", "ㄋㄠ", "ㄌㄠˊ", "ㄖㄠˊ"], difficulty: "hard" },
        { word: "儳", correct: "ㄔㄢˊ", options: ["ㄔㄢˊ", "ㄓㄢˇ", "ㄘㄢ", "ㄙㄢ"], difficulty: "hard" },
        { word: "緲", correct: "ㄇㄧㄠˇ", options: ["ㄇㄧㄠˇ", "ㄇㄠˇ", "ㄇㄧㄠ", "ㄇㄧㄠˋ"], difficulty: "hard" },
        { word: "怫", correct: "ㄈㄨˊ", options: ["ㄈㄨˊ", "ㄅㄛˊ", "ㄈㄨˋ", "ㄆㄛˊ"], difficulty: "hard" },
        { word: "憮", correct: "ㄨˇ", options: ["ㄨˇ", "ㄈㄨˇ", "ㄏㄨˇ", "ㄏㄨˋ"], difficulty: "hard" },
        { word: "醼", correct: "ㄧㄢˋ", options: ["ㄧㄢˋ", "ㄧㄢ", "ㄋㄧㄢˋ", "ㄧㄝˋ"], difficulty: "hard" },
        { word: "跫", correct: "ㄑㄩㄥˊ", options: ["ㄑㄩㄥˊ", "ㄎㄨㄥˊ", "ㄐㄩㄥˊ", "ㄑㄩㄥ"], difficulty: "hard" },
        { word: "顢", correct: "ㄇㄢˊ", options: ["ㄇㄢˊ", "ㄇㄢ", "ㄈㄢˊ", "ㄏㄢ"], difficulty: "hard" },
        { word: "頇", correct: "ㄏㄢ", options: ["ㄏㄢ", "ㄇㄢˊ", "ㄍㄢ", "ㄏㄢˊ"], difficulty: "hard" },
        { word: "褫", correct: "ㄔˇ", options: ["ㄔˇ", "ㄉㄧˇ", "ㄒㄧˇ", "ㄔˊ"], difficulty: "hard" },
        { word: "艟", correct: "ㄔㄨㄥ", options: ["ㄔㄨㄥ", "ㄉㄨㄥ", "ㄐㄩㄥ", "ㄊㄨㄥ"], difficulty: "hard" },
        { word: "艢", correct: "ㄌㄧㄤˇ", options: ["ㄌㄧㄤˇ", "ㄌㄧㄤˊ", "ㄌㄧㄤˋ", "ㄏㄤˇ"], difficulty: "hard" },
        { word: "餽", correct: "ㄎㄨㄟˋ", options: ["ㄎㄨㄟˋ", "ㄏㄨㄟˋ", "ㄍㄨㄟˋ", "ㄎㄨㄟˇ"], difficulty: "hard" },
        { word: "餧", correct: "ㄨㄟˋ", options: ["ㄨㄟˋ", "ㄧˋ", "ㄨㄟˊ", "ㄏㄨㄟˋ"], difficulty: "hard" },
        { word: "鐫", correct: "ㄐㄩㄢ", options: ["ㄐㄩㄢ", "ㄑㄩㄢ", "ㄒㄩㄢ", "ㄓㄨㄢ"], difficulty: "hard" },
        { word: "黜", correct: "ㄔㄨˋ", options: ["ㄔㄨˋ", "ㄊㄨˊ", "ㄓㄨˊ", "ㄔㄨˇ"], difficulty: "hard" },
        { word: "觶", correct: "ㄓˋ", options: ["ㄓˋ", "ㄔˊ", "ㄒㄧㄝˊ", "ㄐㄧˋ"], difficulty: "hard" },
        { word: "齟", correct: "ㄐㄩˇ", options: ["ㄐㄩˇ", "ㄑㄩˇ", "ㄗㄨˇ", "ㄐㄩˋ"], difficulty: "hard" },
        { word: "窳", correct: "ㄩˇ", options: ["ㄩˇ", "ㄧㄚˇ", "ㄩˋ", "ㄌㄩˇ"], difficulty: "hard" },
        { word: "罄", correct: "ㄑㄧㄥˋ", options: ["ㄑㄧㄥˋ", "ㄐㄧㄥˋ", "ㄒㄧㄥˋ", "ㄑㄧㄥ"], difficulty: "hard" },
        { word: "輊", correct: "ㄓˋ", options: ["ㄓˋ", "ㄔˊ", "ㄐㄧˋ", "ㄓ"], difficulty: "hard" },
        { word: "觿", correct: "ㄒㄧ", options: ["ㄒㄧ", "ㄎㄨㄟ", "ㄓˋ", "ㄐㄧ"], difficulty: "hard" },
        { word: "黻", correct: "ㄈㄨˊ", options: ["ㄈㄨˊ", "ㄅㄛˊ", "ㄈㄨˋ", "ㄈㄟˋ"], difficulty: "hard" },
        { word: "皦", correct: "ㄐㄧㄠˇ", options: ["ㄐㄧㄠˇ", "ㄑㄧㄠˇ", "ㄒㄧㄠˇ", "ㄐㄧㄠ"], difficulty: "hard" },
        { word: "顑", correct: "ㄎㄢˇ", options: ["ㄎㄢˇ", "ㄏㄢˇ", "ㄒㄧㄢˇ", "ㄌㄢˇ"], difficulty: "hard" },
        { word: "顜", correct: "ㄐㄧㄤˇ", options: ["ㄐㄧㄤˇ", "ㄑㄧㄤˇ", "ㄒㄧㄤˇ", "ㄍㄤˇ"], difficulty: "hard" },
        { word: "瓖", correct: "ㄒㄧㄤ", options: ["ㄒㄧㄤ", "ㄑㄧㄤ", "ㄒㄩㄥ", "ㄙㄤ"], difficulty: "hard" },
        { word: "蹣", correct: "ㄇㄢˊ", options: ["ㄇㄢˊ", "ㄈㄢˊ", "ㄆㄢˊ", "ㄇㄛˊ"], difficulty: "hard" },
        { word: "瘞", correct: "ㄧˋ", options: ["ㄧˋ", "ㄜˋ", "ㄨㄟˋ", "ㄨˋ"], difficulty: "hard" },
        { word: "饔", correct: "ㄩㄥ", options: ["ㄩㄥ", "ㄨㄥ", "ㄧㄥ", "ㄖㄨㄥ"], difficulty: "hard" },
        { word: "饕", correct: "ㄊㄠ", options: ["ㄊㄠ", "ㄉㄠ", "ㄊㄠˊ", "ㄈㄠ"], difficulty: "hard" },
        { word: "餮", correct: "ㄊㄧㄝˋ", options: ["ㄊㄧㄝˋ", "ㄉㄧㄝˋ", "ㄌㄧㄝˋ", "ㄒㄧㄝˋ"], difficulty: "hard" },
        { word: "廩", correct: "ㄌㄧㄣˇ", options: ["ㄌㄧㄣˇ", "ㄌㄧㄣ", "ㄌㄧㄥˇ", "ㄧㄣˇ"], difficulty: "hard" },
        { word: "穡", correct: "ㄙㄜˋ", options: ["ㄙㄜˋ", "ㄕㄜˋ", "ㄘㄜˋ", "ㄖㄜˋ"], difficulty: "hard" },
        { word: "齲", correct: "ㄑㄩˇ", options: ["ㄑㄩˇ", "ㄐㄩˇ", "ㄒㄩˇ", "ㄩˇ"], difficulty: "hard" },
        { word: "靨", correct: "ㄧㄝˋ", options: ["ㄧㄝˋ", "ㄒㄧㄝˋ", "ㄧㄝ", "ㄋㄧㄝˋ"], difficulty: "hard" },
        { word: "艤", correct: "ㄧˇ", options: ["ㄧˇ", "ㄜˇ", "ㄌㄧˇ", "ㄋㄧˇ"], difficulty: "hard" },
        { word: "黹", correct: "ㄓˇ", options: ["ㄓˇ", "ㄔˇ", "ㄗˇ", "ㄕˇ"], difficulty: "hard" },
        { word: "戔", correct: "ㄐㄧㄢ", options: ["ㄐㄧㄢ", "ㄑㄧㄢ", "ㄒㄧㄢ", "ㄓㄢ"], difficulty: "hard" },
        { word: "靽", correct: "ㄅㄢˋ", options: ["ㄅㄢˋ", "ㄆㄢˋ", "ㄇㄢˋ", "ㄈㄢˋ"], difficulty: "hard" },
        { word: "憒", correct: "ㄎㄨㄟˋ", options: ["ㄎㄨㄟˋ", "ㄍㄨㄟˋ", "ㄏㄨㄟˋ", "ㄨㄟˋ"], difficulty: "hard" },
        { word: "霪", correct: "ㄧㄣˊ", options: ["ㄧㄣˊ", "ㄧㄣ", "ㄧㄥˊ", "ㄌㄧㄣˊ"], difficulty: "hard" },
        { word: "醓", correct: "ㄊㄢˇ", options: ["ㄊㄢˇ", "ㄉㄢˇ", "ㄋㄢˇ", "ㄌㄢˇ"], difficulty: "hard" },
    ];

    // --- 輔助函數：Fisher-Yates 隨機洗牌算法 ---
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [
                array[randomIndex], array[currentIndex]
            ];
        }
        return array;
    }

    // --- 遊戲初始化和開始邏輯 ---
    function startGame(numQuestions) {
        if (numQuestions > 150) numQuestions = 150; 
        
        // 1. 拆分並洗牌題庫
        const easyQuestions = allQuizData.filter(q => q.difficulty === 'easy');
        const hardQuestions = allQuizData.filter(q => q.difficulty === 'hard');
        
        const shuffledEasy = shuffle([...easyQuestions]);
        const shuffledHard = shuffle([...hardQuestions]);

        // 2. 確定題數分配 (盡量保持 50/100 比例)
        const targetEasy = Math.min(Math.ceil(numQuestions * (50/150)), 50); 
        const targetHard = numQuestions - targetEasy;

        // 3. 組合最終測驗列表
        let selectedEasy = shuffledEasy.slice(0, targetEasy);
        let selectedHard = shuffledHard.slice(0, targetHard);

        currentQuiz = shuffle(selectedEasy.concat(selectedHard));
        
        currentQuestionIndex = 0;
        score = 0;
        correctCount = 0;
        wrongCount = 0;
        skippedCount = 0;
        totalQuestions = currentQuiz.length;

        // 隱藏開始畫面，顯示倒數
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('countdown-overlay').style.display = 'flex';

        startCountdown();
    }
    
    // --- 倒數計時邏輯 ---
    function startCountdown() {
        let count = 3;
        const countdownNumber = document.getElementById('countdown-number');
        countdownNumber.textContent = count;

        const countdownInterval = setInterval(() => {
            count--;
            countdownNumber.textContent = count;

            if (count === 0) {
                clearInterval(countdownInterval);
                document.getElementById('countdown-overlay').style.display = 'none';
                document.getElementById('quiz-screen').style.display = 'block';
                document.getElementById('current-q').textContent = `第 ${currentQuestionIndex + 1} 題 / 共 ${totalQuestions} 題`;
                loadQuestion();
            }
        }, 1000);
    }


    // --- 載入題目邏輯 ---
    function loadQuestion() {
        if (currentQuestionIndex >= totalQuestions) {
            endGame();
            return;
        }

        const currentQ = currentQuiz[currentQuestionIndex];
        
        // 設置計時器
        timeLimit = currentQ.difficulty === 'easy' ? 5 : 8; // 簡單題 5s, 較難題 8s
        document.getElementById('time-left').textContent = timeLimit;
        startTime = Date.now();
        clearInterval(timer);
        timer = setInterval(updateTimer, 100); // 每 100ms 更新一次，更流暢

        // 設置問題和選項
        document.getElementById('question-word').textContent = currentQ.word;
        const optionsContainer = document.getElementById('options-container');
        
        // 洗牌選項並設置按鈕
        const shuffledOptions = shuffle([...currentQ.options]);
        const buttons = optionsContainer.getElementsByClassName('option-button');
        
        for (let i = 0; i < buttons.length; i++) {
            buttons[i].textContent = shuffledOptions[i];
            buttons[i].onclick = () => checkAnswer(buttons[i], currentQ.correct);
            buttons[i].classList.remove('correct', 'incorrect');
            buttons[i].disabled = false;
        }

        // 更新狀態
        document.getElementById('current-q').textContent = `第 ${currentQuestionIndex + 1} 題 / 共 ${totalQuestions} 題`;
        document.getElementById('score-display').textContent = `總分數: ${score}`;
    }

    // --- 計時器更新邏輯 ---
    function updateTimer() {
        const elapsed = Date.now() - startTime;
        let timeLeft = timeLimit - Math.floor(elapsed / 1000);
        
        if (timeLeft < 0) {
            clearInterval(timer);
            timeLeft = 0;
            // 時間到，計為未作答
            skippedCount++;
            handleAnswer(false, 0, currentQuiz[currentQuestionIndex].correct); 
            // 由於 handleAnswer 已經處理了下一個題目，這裡不需要額外操作
        }

        document.getElementById('time-left').textContent = timeLeft;
    }

    // --- 檢查答案邏輯 ---
    function checkAnswer(button, correctAnswer) {
        clearInterval(timer);
        const selectedAnswer = button.textContent;
        const isCorrect = selectedAnswer === correctAnswer;
        
        // 計算得分
        let points = 0;
        const elapsedSeconds = (Date.now() - startTime) / 1000;

        if (isCorrect) {
            correctCount++;
            
            if (currentQuiz[currentQuestionIndex].difficulty === 'easy') {
                points = 10;
                if (elapsedSeconds <= 3) points += 5; // 簡單題 3s 內額外加 5
            } else {
                points = 15;
                if (elapsedSeconds <= 5) points += 10; // 較難題 5s 內額外加 10
            }
            score += points;
        } else {
            wrongCount++;
        }

        // 視覺反饋
        handleAnswer(isCorrect, points, correctAnswer);
    }

    // --- 處理答案結果及進入下一題 ---
    function handleAnswer(isCorrect, points, correctAnswer) {
        const optionsContainer = document.getElementById('options-container');
        const buttons = optionsContainer.getElementsByClassName('option-button');

        // 禁用所有按鈕
        for (let button of buttons) {
            button.disabled = true;
            if (button.textContent === correctAnswer) {
                button.classList.add('correct');
            } else if (!isCorrect && button.disabled) {
                 // 如果選錯了或超時，標記正確答案
                if (button.textContent !== correctAnswer) {
                     // 讓選中的按鈕變紅 (如果不是正確答案的話)
                     if (isCorrect === false && points === 0) {
                         // 超時/未作答，不做特殊標記，只標記正確答案
                     } else if (button.textContent === selectedAnswer) {
                         button.classList.add('incorrect');
                     }
                }
            }
        }
        
        // 確保選中的按鈕被標記
        if (!isCorrect && points > 0) { // 錯誤點擊，points=0
            const selectedButton = Array.from(buttons).find(b => b.textContent === selectedAnswer);
            if(selectedButton) selectedButton.classList.add('incorrect');
        }


        // 顯示得分/結果
        document.getElementById('score-display').textContent = `總分數: ${score} (+${points})`;

        // 延遲後進入下一題
        setTimeout(() => {
            currentQuestionIndex++;
            loadQuestion();
        }, 1000); 
    }
    
    // --- 遊戲結束邏輯 ---
    function endGame() {
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        
        document.getElementById('final-score').textContent = score;
        document.getElementById('correct-count').textContent = correctCount;
        document.getElementById('wrong-count').textContent = wrongCount;
        document.getElementById('skipped-count').textContent = totalQuestions - correctCount - wrongCount;

        clearInterval(timer);
    }

    // --- 遊戲重置邏輯 ---
    function resetGame() {
        document.getElementById('result-screen').style.display = 'none';
        document.getElementById('start-screen').style.display = 'block';
        currentQuiz = [];
    }

</script>
</body>
</html>
